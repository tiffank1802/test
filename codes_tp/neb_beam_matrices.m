function [Kfull,Cfull,Mfull] = neb_beam_matrices( nx, dx, E, Ix, rho, S, cy )
   % Compute the FE matrices for Navier-Euler-Bernoulli beams
   % Third order Hermite polynomials
   
   npt = nx + 1; ndof = 2*npt;
   doflist = 1:2:ndof-3;
   on1 = ones(1,nx);

   % Hermite third order polynomials Stiffness (no rage to my sparse vodoo)
   Ki = [ doflist, doflist, doflist, doflist,...
          doflist+1, doflist+1, doflist+1, doflist+1,...
          doflist+2, doflist+2, doflist+2, doflist+2,...
          doflist+3, doflist+3, doflist+3, doflist+3 ];
   Kj = [ doflist, doflist+1, doflist+2, doflist+3,...
          doflist, doflist+1, doflist+2, doflist+3,...
          doflist, doflist+1, doflist+2, doflist+3,...
          doflist, doflist+1, doflist+2, doflist+3 ];
   Kv = E*Ix/(dx^3)* [ 12*on1,   6*dx*on1,   -12*on1,   6*dx*on1,...
                       6*dx*on1, 4*dx^2*on1, -6*dx*on1, 2*dx^2*on1,...
                       -12*on1,  -6*dx*on1,  12*on1,    -6*dx*on1,...
                       6*dx*on1, 2*dx^2*on1, -6*dx*on1, 4*dx^2*on1 ];
   Kfull = sparse( Ki, Kj, Kv, ndof, ndof );

   % Mass
   Mv1 = rho*S*dx/420 * [ 156*on1,    22*dx*on1,   54*on1,     -13*dx*on1,...
                          22*dx*on1,  4*dx^2*on1,  13*dx*on1,  -3*dx^2*on1,...
                          54*on1,     13*dx*on1,   156*on1,    -22*dx*on1,...
                          -13*dx*on1, -3*dx^2*on1, -22*dx*on1, 4*dx^2*on1 ];
                          
   %Mv2 = rho*Ix/(30*dx) * [ 36*on1,   3*dx*on1,   -36*on1,   3*dx*on1,... % Second order term
   %                       3*dx*on1, 4*dx^2*on1, -3*dx*on1, dx^2*on1,...
   %                       -36*on1,  -3*dx*on1,  36*on1,    -3*dx*on1,...
   %                       3*dx*on1, dx^2*on1,   -3*dx*on1, 4*dx^2*on1 ];

   Mfull = sparse( Ki, Kj, Mv1, ndof, ndof );

   % Damping
   Cv = cy*dx/420 * [ 156*on1,    22*dx*on1,   54*on1,     -13*dx*on1,...
                      22*dx*on1,  4*dx^2*on1,  13*dx*on1,  -3*dx^2*on1,...
                      54*on1,     13*dx*on1,   156*on1,    -22*dx*on1,...
                      -13*dx*on1, -3*dx^2*on1, -22*dx*on1, 4*dx^2*on1 ];
   Cfull = sparse( Ki, Kj, Cv, ndof, ndof );

end
